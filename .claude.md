# HorseTravel - Claude Project Instructions

## Project Overview
HorseTravel is a mobile application for managing horse transportation logistics. It's designed for studs, riding clubs, and transport companies to streamline the entire transport process from planning to documentation and monitoring.

## Tech Stack
- **Platform**: Mobile (iOS & Android)
- **Framework**: Expo (React Native)
- **Language**: JavaScript
- **Backend**: Firebase (Firestore, Auth, Storage)
- **Maps**: React Native Maps + Google Maps API
- **Testing Environment**: Expo Go

## Project Structure
See `APP_STRUCTURE.md` for detailed folder and file organization.

## Core Requirements

### Key Features
1. **Intelligent Route Planning**
   - Vehicle and horse setup with detailed information
   - GPS-based location suggestions and optimized routing
   - Interactive maps with border crossings and regulations
   - EU-compliant break suggestions
   - Automatic vehicle identification via motor registry
   - Real-time cost calculation (fuel, tolls, time)

2. **Legal Document Handling**
   - Digitized transport documents (international standards)
   - Auto-fill health certificates, logbooks, and certificates
   - Country-specific templates (TRACES, health certificates)
   - Digital archive with searchable history

3. **Fleet Management & Monitoring**
   - Live tracking of all active transports
   - Status overview for drivers and horses
   - Estimated arrival times with continuous updates
   - Alerts for deviations (delays, route changes, breaks)

## Firebase Configuration

### Required Environment Variables (.env)
```
FIREBASE_API_KEY=your_api_key
FIREBASE_AUTH_DOMAIN=your_auth_domain
FIREBASE_PROJECT_ID=your_project_id
FIREBASE_STORAGE_BUCKET=your_storage_bucket
FIREBASE_MESSAGING_SENDER_ID=your_sender_id
FIREBASE_APP_ID=your_app_id
GOOGLE_MAPS_API_KEY=your_maps_key
```

### Firestore Collections
- `users` - User profiles and authentication
- `vehicles` - Vehicle registry
- `horses` - Horse registry with health data
- `transports` - Transport records and tracking
- `documents` - Legal documentation
- `alerts` - System notifications and warnings

## Development Guidelines

### Code Style
- Use functional components with hooks
- Follow React Native best practices
- Use async/await for Firebase operations
- Implement proper error handling
- Keep components small and focused

### File Organization
- Components in `src/components/` (reusable UI)
- Screens in `src/screens/` (full-page views)
- Business logic in `src/services/`
- State management in `src/store/context/`
- Utilities in `src/utils/`

### State Management
- Use React Context API for global state
- AuthContext for authentication
- TransportContext for transport data
- FleetContext for vehicles/horses
- DocumentContext for documentation

### Navigation
- React Navigation (Stack + Bottom Tabs)
- Auth flow separate from main app flow
- Tab-based main navigation with 5 tabs:
  1. Home
  2. Planning
  3. Tracking
  4. Fleet
  5. Documents

## Common Tasks

### Adding a New Screen
1. Create screen file in appropriate `src/screens/` subfolder
2. Add navigation route in `src/navigation/`
3. Import and use required services from `src/services/`
4. Connect to relevant Context if needed

### Adding Firebase Operations
1. Create/update service file in `src/services/firebase/`
2. Use Firestore for data operations
3. Implement error handling
4. Update Context if state needs to be global

### Working with Maps
1. Use `react-native-maps` for map display
2. Implement GPS tracking via `expo-location`
3. Calculate routes using Google Maps API
4. Store coordinates in Firestore as `{lat, lng}`

### Document Generation
1. Use templates from `src/services/documents/templates.js`
2. Auto-fill data from transport/horse/vehicle records
3. Generate PDF using `react-native-pdf`
4. Store in Firebase Storage
5. Save metadata in Firestore `documents` collection

## Important Implementation Notes

### GPS & Real-Time Tracking
- Request location permissions on app start
- Use background location for active transports
- Update Firestore every 1-5 minutes during transport
- Implement geofencing for border crossings

### EU Transport Regulations
- Maximum 8 hours driving without 45-minute break
- Track total journey time
- Alert driver 30 minutes before required break
- Log all breaks in transport record

### Document Compliance
- TRACES required for EU cross-border transport
- Health certificates country-specific
- Keep digital copies for minimum 3 years
- Export as PDF for authorities

### Performance Optimization
- Use FlatList for long lists (vehicles, horses, transports)
- Implement pagination for Firestore queries
- Cache map tiles when possible
- Lazy load screens with React.lazy (if needed)

## Testing Strategy
- Test on both iOS and Android via Expo Go
- Verify GPS accuracy in real-world conditions
- Test offline functionality for critical features
- Validate document generation with sample data
- Test Firebase security rules

## Development Phases (Priority Order)
1. Firebase setup + Authentication
2. Fleet Management (vehicles & horses)
3. Transport Planning + Route Maps
4. Live Tracking + GPS integration
5. Document Management + Templates
6. UI/UX polish + Testing

## Common Debugging
- **Firebase errors**: Check `.env` configuration
- **Map not showing**: Verify Google Maps API key
- **GPS not working**: Check location permissions in app.json
- **Expo errors**: Clear cache with `expo start -c`

## Security Considerations
- Implement Firestore security rules
- Validate all user inputs
- Sanitize data before document generation
- Use Firebase Auth for all protected routes
- Never commit `.env` file to git

## Resources
- [Expo Documentation](https://docs.expo.dev/)
- [React Native Maps](https://github.com/react-native-maps/react-native-maps)
- [Firebase Docs](https://firebase.google.com/docs)
- [EU Transport Regulations](https://ec.europa.eu/food/animals/animal-welfare/practice/transport_en)
